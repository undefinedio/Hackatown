<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Headtracking</title>
	<link rel="stylesheet" type="text/css" href="css/main.css">

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>



	<script src="libs/headtrackr.js"></script>
	<script src="libs/video.js"></script>
	<script src="libs/collision.js"></script>


	<script src="http://code.createjs.com/createjs-2013.12.12.min.js"></script>

	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBlDrJ8JGU0l4Jhlifpk2HdfurwuISEdw&sensor=false"></script>


</head>
<body>
<audio autoplay>
	<source src="audio/n1.mp3" type="audio/mpeg">
</audio>
<video width="100%" autoplay loop style="z-index: -10; position: absolute;" >
	<source src="video/fullmarch.mp4" type="video/mp4" />
</video>
<section id="js-page-intro" class="page">
	<h1>Intro</h1>
	<input type="text" placeholder="BOM WHAT NOW ?">
</section>
<section id="js-page-game" class="page hidden">
	<div class="wrapper" id="wrapper">
	<canvas id="inputCanvas" width="320" height="240" style="display:none"></canvas>
	<canvas id="game"></canvas>
		<div class="map-container">
			<div id="map-canvas"></div>
		</div>
	</div>
</section>


<canvas id="leader"></canvas>
<video id="inputVideo" autoplay loop></video>

<script src="js/fighterplane.js"></script>

<script src="js/game.js"></script>
<script src="js/rocket.js"></script>
<script src="js/headtracker.js"></script>
<script src="js/clouds.js"></script>
<script src="js/fighterplane.js"></script>


<script type="text/javascript" src="js/map.js"></script>


<script type="text/javascript">

	function getRandom(min, max) {
		return Math.random() * (max - min) + min;
	}

	var perm = false;
	var game = new Game();
	var tracker = new Tracker();
	var rocket = new Rocket();
	var destination;

	function permTrue () {
		perm = true;
		initStuff();
	}

	$("input").on("keyup" , function(e){
		console.log(arguments);
		if (e.keyCode == 13) {
			destination = e.currentTarget.value;
	        initStuff();
	    }
	});

	function permError () {
		alert("PERMISSIONS NOW!!");
	}

	function initStuff() {
		if(!perm){
			destination = undefined;
			permError();
			return false;
		} 
		if(!destination) return false;
		game.start();
		fetch();
		function tryAgain () {
			console.log("test");
			//show error
		}
		function fetch(){
			$.ajax({
			  dataType: "json",
			  url: "http://nominatim.openstreetmap.org/search?q="+destination+"&format=json&polygon=1&addressdetails=1",
			  type: "GET",
			  success: function(data){
			  	//console.log(data);
			  	if(data.length){
			  		$(".page").hide();
			  		$("#js-page-game").show();
			  		$("#inputVideo").show();
			  		//console.log(mapObj);
			  		mapObj.destionation.lat = parseInt(data[0].lat,10);
			  		mapObj.destionation.long = parseInt(data[0].lon,10);
			  		//console.log(mapObj);
			  		mapObj.init();
			  		mapObj.startLoop();
			  	}else{
			  		tryAgain();
			  	}
			  }
		});
		}
	}


	
	
</script>
</body>
</html>